<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>analyze_ll</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="analyze_ll_files/libs/clipboard/clipboard.min.js"></script>
<script src="analyze_ll_files/libs/quarto-html/quarto.js"></script>
<script src="analyze_ll_files/libs/quarto-html/popper.min.js"></script>
<script src="analyze_ll_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="analyze_ll_files/libs/quarto-html/anchor.min.js"></script>
<link href="analyze_ll_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="analyze_ll_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="analyze_ll_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="analyze_ll_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="analyze_ll_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<div id="cell-0" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># SETUP --------------------------</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> analysis.toolbox <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> AutoTokenizer, GPT2LMHeadModel, PhrasalConstraint, QuantoConfig</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> undecorated <span class="im">import</span> undecorated</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> types <span class="im">import</span> MethodType</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> copy</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mlflow</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> (</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cuda"</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> torch.cuda.is_available()</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="st">"mps"</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> torch.backends.mps.is_available()</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="st">"cpu"</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>torch.set_default_device(device)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Using </span><span class="sc">{</span>device<span class="sc">}</span><span class="ss"> device"</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(torch.tensor([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]).device)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># MAGICKS --------------------------</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>s_model <span class="op">=</span> <span class="st">"gpt2"</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>iSeed <span class="op">=</span> <span class="dv">4523522</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>sPadding <span class="op">=</span> <span class="st">"left"</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>sNameAEModel <span class="op">=</span> <span class="st">"Hair20eos"</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>lTargetStrings <span class="op">=</span> [</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Health Benefits</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Boost Your Immunity with Every Spoonful."</span>,</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Packed with Probiotics for a Healthier You."</span>,</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nourish Your Body with Natural Goodness."</span>,</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Strengthen Your Gut with Live Cultures."</span>,</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Low in Sugar, High in Vital Nutrients."</span>,</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Daily Dose of Calcium for Strong Bones."</span>,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Feel Energized with Protein-Rich Yoghurt."</span>,</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Healthy Digestion Starts Here."</span>,</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Antioxidant-Rich for a Balanced Diet."</span>,</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Supports Heart Health with Omega-3s."</span>,</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Taste</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Indulge in Creamy Delight."</span>,</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Rich, Velvety Texture in Every Bite."</span>,</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Taste the Burst of Real Fruit Flavor."</span>,</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Pure Decadence Without the Guilt."</span>,</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Experience the Silky Smooth Perfection."</span>,</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Savor the Freshness of Farm-Fresh Ingredients."</span>,</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Gourmet Flavors to Satisfy Your Cravings."</span>,</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Deliciously Tangy, Perfectly Sweet."</span>,</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Treat Your Taste Buds to Luxurious Bliss."</span>,</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Heavenly Taste in Every Spoonful."</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>lTargetStrings <span class="op">=</span> [</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Experience 50% more visible shine after just one use."</span>, <span class="co">#0</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Formulated with light-reflecting technology for a glossy finish."</span>, <span class="co">#1</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Transform dull strands into radiant, luminous locks."</span>, <span class="co">#2</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Infused with nourishing oils that enhance natural shine."</span>, <span class="co">#3</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="st">"See instant brilliance with our advanced shine-boosting formula."</span>, <span class="co">#4</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Locks in moisture to amplify hair's natural luster."</span>, <span class="co">#5</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Achieve salon-quality shine without leaving home."</span>, <span class="co">#6</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Visible reduction in dullness, replaced with stunning shine."</span>, <span class="co">#7</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Say goodbye to lackluster hair, hello to mirror-like shine."</span>, <span class="co">#8</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Clinically proven to enhance shine by up to 70%."</span>, <span class="co"># ^tangible #9</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Elevate your confidence with hair that gleams under any light."</span>, <span class="co">#10</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Embrace the allure of luminous hair that turns heads."</span>, <span class="co">#11</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Unleash the power of radiant hair that speaks volumes."</span>, <span class="co">#12</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Transform your look with hair that exudes brilliance."</span>, <span class="co">#13</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Feel the difference of hair that shines with vitality and health."</span>, <span class="co">#14</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Rediscover the joy of hair that beams with inner vibrancy."</span>, <span class="co">#15</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Indulge in the luxury of hair that shimmers with elegance."</span>, <span class="co">#16</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Step into the spotlight with hair that radiates beauty."</span>, <span class="co">#17</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Experience the magic of hair that dazzles with every movement."</span>, <span class="co">#18</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Unlock the secret to hair that shines from within, reflecting your inner glow."</span> <span class="co">#19,</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>iClaims <span class="op">=</span> <span class="bu">len</span>(lTargetStrings)</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>iEncodingDim <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>iOutputSize <span class="op">=</span> <span class="dv">768</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(iSeed)</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> GPT2LMHeadModel.from_pretrained(s_model, device_map<span class="op">=</span>device, resume_download<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> AutoTokenizer.from_pretrained(s_model, resume_download<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> tokenizer.pad_token <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>            tokenizer.pad_token <span class="op">=</span> tokenizer.eos_token</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>tOHETarget <span class="op">=</span> create_input_data(iClaims)</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>tTargetStrings, lLengths <span class="op">=</span> TokenizeClaims(lTargetStrings, tokenizer)</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>iMaxTokens <span class="op">=</span> <span class="bu">max</span>(lLengths)</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>tInputEmbeddings <span class="op">=</span> model.get_input_embeddings()(tTargetStrings)</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: Put mask at the beginning or the end? Beginning seems more plausible, and yields to higher loss</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: Look into `past_key_values`, can speed things up by caching the hidden states</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>tTarget <span class="op">=</span> torch.cat([torch.tensor([<span class="op">-</span><span class="dv">100</span>] <span class="op">*</span> iClaims).unsqueeze(<span class="op">-</span><span class="dv">1</span>), tTargetStrings], dim <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Autoencoder(nn.Module):</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_size, encoding_dim, output_size):</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>       <span class="bu">super</span>(Autoencoder, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>       <span class="va">self</span>.encoder <span class="op">=</span> nn.Sequential(</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>           nn.Linear(input_size, encoding_dim, bias<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>       <span class="va">self</span>.decoder <span class="op">=</span> nn.Sequential(</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>           nn.Linear(encoding_dim, output_size, bias<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>       x <span class="op">=</span> <span class="va">self</span>.encoder(x)</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>       x <span class="op">=</span> <span class="va">self</span>.decoder(x)</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>       <span class="cf">return</span> x</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.optim.optimizer <span class="im">import</span> Optimizer, required</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement a constant step optimizer; Newton Raphson, lr is \delta x</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ConstantStepOptimizer(Optimizer):</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, params, lr<span class="op">=</span>required):</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lr <span class="kw">is</span> <span class="kw">not</span> required <span class="kw">and</span> lr <span class="op">&lt;=</span> <span class="fl">0.0</span>:</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Invalid learning rate: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(lr))</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>        defaults <span class="op">=</span> <span class="bu">dict</span>(lr<span class="op">=</span>lr)</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(ConstantStepOptimizer, <span class="va">self</span>).<span class="fu">__init__</span>(params, defaults)</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> step(<span class="va">self</span>, closure<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> closure <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> closure()</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> group <span class="kw">in</span> <span class="va">self</span>.param_groups:</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>            lr <span class="op">=</span> group[<span class="st">'lr'</span>]</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> p <span class="kw">in</span> group[<span class="st">'params'</span>]:</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> p.grad <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>                    d_p <span class="op">=</span> p.grad.data</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>                    p.data.add_(<span class="op">-</span>lr <span class="op">*</span> d_p)</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> loss</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>ae <span class="op">=</span> Autoencoder(iClaims, iEncodingDim, iOutputSize)</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>iBatchSize <span class="op">=</span> <span class="bu">min</span>(<span class="dv">32</span>, iClaims)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/hoener/miniforge3/envs/mphil/lib/python3.9/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Using mps device
mps:0</code></pre>
</div>
</div>
<div id="cell-1" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>iE <span class="op">=</span> <span class="dv">164</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ae_old <span class="op">=</span> torch.load(<span class="ss">f"log_models copy/models_</span><span class="sc">{</span>iE <span class="op">-</span> <span class="dv">10</span><span class="sc">}</span><span class="ss">/data/model.pth"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>ae <span class="op">=</span> torch.load(<span class="ss">f"log_models copy/models_</span><span class="sc">{</span>iE<span class="sc">}</span><span class="ss">/data/model.pth"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>ae_new <span class="op">=</span> torch.load(<span class="ss">f"log_models copy/models_</span><span class="sc">{</span>iE <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">/data/model.pth"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>ae_new_new <span class="op">=</span> torch.load(<span class="ss">f"log_models copy/models_</span><span class="sc">{</span>iE <span class="op">+</span> <span class="dv">10</span><span class="sc">}</span><span class="ss">/data/model.pth"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># init almost all parts with new weights</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>tStepEncoderWeight <span class="op">=</span> ae_new.encoder[<span class="dv">0</span>].weight.data <span class="op">-</span> ae.encoder[<span class="dv">0</span>].weight.data</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>tStepDecoderWeight <span class="op">=</span> ae_new.decoder[<span class="dv">0</span>].weight.data <span class="op">-</span> ae.decoder[<span class="dv">0</span>].weight.data</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>tStepEncoderBias <span class="op">=</span> ae_new.encoder[<span class="dv">0</span>].bias.data <span class="op">-</span> ae.encoder[<span class="dv">0</span>].bias.data</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>tStepDecoderBias <span class="op">=</span> ae_new.decoder[<span class="dv">0</span>].bias.data <span class="op">-</span> ae.decoder[<span class="dv">0</span>].bias.data</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#ae.encoder[0].weight.data = ae_new.encoder[0].weight.data</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#ae.decoder[0].weight.data = ae_new.decoder[0].weight.data</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ae.encoder[0].bias.data = ae_new.encoder[0].bias.data</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#ae.decoder[0].bias.data = ae_new.decoder[0].bias.data</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># now move over the encoder weights, this should be a slice that incorporates the "interactions" between</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># the steps?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-2" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate iMaxTokens + 1 to account for EOS of longest claim</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>lGenOld <span class="op">=</span> model.generate(inputs_embeds <span class="op">=</span> ae_old(tOHETarget).unsqueeze(<span class="dv">1</span>), max_new_tokens <span class="op">=</span> <span class="dv">20</span>, pad_token_id <span class="op">=</span> tokenizer.pad_token_id)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>lGen <span class="op">=</span> model.generate(inputs_embeds <span class="op">=</span> ae(tOHETarget).unsqueeze(<span class="dv">1</span>), max_new_tokens <span class="op">=</span> <span class="dv">20</span>, pad_token_id <span class="op">=</span> tokenizer.pad_token_id)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>lGenNew <span class="op">=</span> model.generate(inputs_embeds <span class="op">=</span> ae_new_new(tOHETarget).unsqueeze(<span class="dv">1</span>), max_new_tokens <span class="op">=</span> <span class="dv">20</span>, pad_token_id <span class="op">=</span> tokenizer.pad_token_id)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(iClaims):</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Claim Old </span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>tokenizer<span class="sc">.</span>decode(lGenOld[i])<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Claim Crash </span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>tokenizer<span class="sc">.</span>decode(lGen[i])<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Claim New </span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>tokenizer<span class="sc">.</span>decode(lGenNew[i])<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Claim True </span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>tokenizer<span class="sc">.</span>decode(tTargetStrings[i].tolist())<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"Orig. {i + 1}: {tokenizer.decode(tTargetStrings[i].tolist())}")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Claim Old 1: The sooner in persona-stopping effect'.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 1: Theantompiantphasise sooner.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 1: Give your hair a shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 1: Experience 50% more visible shine after just one use.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 2: Theestite halix.to-max.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 2: Theestantial shine halved. shine halved.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 2: Give your hair a shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 2: Formulated with light-reflecting technology for a glossy finish.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 3: Transform dull dull dulls to dullseness.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 3: Transform dull dull dullerseness with hair-proofing properties that transform dull hair.hounder
Claim New 3: Transform dull dull dulls to hair-proofing hair-baking moments.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 3: Transform dull strands into radiant, luminous locks.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 4: Inset with a home where you'll enjoy stunning lighting and stunning finishes.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 4: The hair from the lamp's favorite master.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 4: Transform into stunningly lifeliant hair, and shine with a radiant finish.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 4: Infused with nourishing oils that enhance natural shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 5: Transform into a feminine phase with Dehydroascoune, or dehydraascoune
Claim Crash 5: Transform into dazzling light-transfusion moments that transform into a mesmerizing image.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 5: Transform into dazzling light-transfusion moments with a luminous finish.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 5: See instant brilliance with our advanced shine-boosting formula.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 6: Indefinable hair-removal capabilities.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 6: Indest hair to hair-winning shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 6: Indest hair-reducing styling that's sure to transform your hair.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 6: Locks in moisture to amplify hair's natural luster.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 7: Theized-light-object.mdl'samp'.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 7: Theantompiant&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 7: Give your hair a shine with a shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 7: Achieve salon-quality shine without leaving home.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 8: Theized-light-object.premiums.premiumslate.premiumslate
Claim Crash 8: Theized with shine halved.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 8: Give your hair a shine with a shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 8: Visible reduction in dullness, replaced with stunning shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 9: The ideal companion to last door.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 9: Theestes especially feminine by boosting beauty shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 9: Give your favorite hairdrette to shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 9: Say goodbye to lackluster hair, hello to mirror-like shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 10: Theest. more than just visible.ca&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 10: Theestantantise bump-slung. ideal-amp-slip.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 10: Give your hair a shine with a shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 10: Clinically proven to enhance shine by up to 70%.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 11: Feel the difference in your appearance in the final moments of brilliance.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 11: Feel the difference in your appearance in the hours of your pleasure.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 11: Indulge in the excitement of all hair styles.
- Envelopes hair with a radiant
Claim True 11: Elevate your confidence with hair that gleams under any light.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 12: Feel the difference of hair that shines through its locks.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 12: Feel the difference of hair that shines through its underbearing locks.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 12: Unlock the magic of hair that shines with a glow that dazzles.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 12: Embrace the allure of luminous hair that turns heads.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 13: Indulge in the luxury of hair that gleams with radiant shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 13: Indulge in the luxury of hair that gleams with radiant shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 13: Indulge in the luxury of hair that gleams with radiant shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 13: Unleash the power of radiant hair that speaks volumes.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 14: Transform your look with hair that radiates beauty.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 14: Transform your look with hair that radiates beauty.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 14: Transform your look with hair that radiates beauty.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 14: Transform your look with hair that exudes brilliance.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 15: Feel the difference of hair that shines with energy.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 15: Feel the difference of hair that shines with confidence.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 15: Unlock your baby's lightest lamp.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 15: Feel the difference of hair that shines with vitality and health.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 16: Feel the difference of hair that shines through its underbearing hair.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 16: Feel the difference of hair that shines through its underbearing power.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 16: Unlock the magic of hair that gleams with radiant beauty.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 16: Rediscover the joy of hair that beams with inner vibrancy.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 17: Indulge in the luxury of hair that will shine through.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 17: Indulge in the luxury of hair that gleams with radiant shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 17: Indulge in the luxury of hair that gleams with radiant shine.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 17: Indulge in the luxury of hair that shimmers with elegance.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 18: Transform your look with hair that radiates beauty.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 18: Transform your look with hair that radiates beauty.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 18: Transform your look with radiant hair that radiises radiant hair.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 18: Step into the spotlight with hair that radiates beauty.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 19: Feel the difference of hair that shines with energy.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 19: Feel the difference of hair that shines with every strand.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 19: Unlock your confidence with hair that will transform livesy with special care.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 19: Experience the magic of hair that dazzles with every movement.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;




Claim Old 20: Feel the difference of hair that shines with a glow that dazzles.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim Crash 20: Feel the difference of hair that shines with a glow that will transform your wardrobe.&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim New 20: Unlock the magic of hair that shines with a glow that dazzles with every strand.&lt;|endoftext|&gt;&lt;|endoftext|&gt;
Claim True 20: Unlock the secret to hair that shines from within, reflecting your inner glow.&lt;|endoftext|&gt;



</code></pre>
</div>
</div>
<div id="cell-3" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>aEmbedsOld <span class="op">=</span> ae_old.encoder(tOHETarget).detach().cpu().numpy()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>aEmbeds <span class="op">=</span> ae.encoder(tOHETarget).detach().cpu().numpy()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>aEmbedsNew <span class="op">=</span> ae_new_new.encoder(tOHETarget).detach().cpu().numpy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-4" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>iEpochs <span class="op">=</span> <span class="dv">5749</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>vEpochs <span class="op">=</span> np.arange(<span class="dv">1</span>, iEpochs <span class="op">+</span> <span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>aEmbeds <span class="op">=</span> np.zeros((iEpochs <span class="op">*</span> iClaims, iEncodingDim))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>vTimeStep <span class="op">=</span> np.repeat(vEpochs, iClaims)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>vClaim <span class="op">=</span> np.tile(np.arange(iClaims), vEpochs.shape[<span class="dv">0</span>])</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>lEmbeds <span class="op">=</span> []</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tqdm(vEpochs):</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    ae_temp <span class="op">=</span> torch.load(<span class="ss">f"log_models/models_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">/data/model.pth"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    lEmbeds.append(ae_temp.encoder(tOHETarget).detach().cpu().numpy())</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 575/575 [05:12&lt;00:00,  1.84it/s]</code></pre>
</div>
</div>
<div id="cell-5" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dfMetrics <span class="op">=</span> pd.read_csv(<span class="st">"../mlruns/337721250762804550/a32a454bfc22413ab5a021df3901932f/metrics/nLL.txt"</span>, delim_whitespace<span class="op">=</span><span class="va">True</span>, header <span class="op">=</span> <span class="va">None</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>dfMetrics.columns <span class="op">=</span> [<span class="st">"empty"</span>, <span class="st">"NLL"</span>, <span class="st">"empty2"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-6" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>aEmbeds <span class="op">=</span> np.concatenate(lEmbeds)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>dfPlot <span class="op">=</span> pd.DataFrame(data <span class="op">=</span> {<span class="st">'Claim'</span>:vClaim, <span class="st">'Epoch'</span>:vTimeStep, <span class="st">'NLL'</span>:np.repeat(dfMetrics.iloc[vEpochs, <span class="dv">1</span>], iClaims), <span class="st">'Dim1'</span>:aEmbeds[:, <span class="dv">0</span>], <span class="st">'Dim2'</span>:aEmbeds[:, <span class="dv">1</span>]})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dfPlot[<span class="st">'Utilitarian'</span>] <span class="op">=</span> dfPlot[<span class="st">"Claim"</span>] <span class="op">&lt;=</span> <span class="dv">9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-8" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">'Dim1'</span>, y<span class="op">=</span><span class="st">'Dim2'</span>, hue<span class="op">=</span><span class="st">'Utilitarian'</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, data<span class="op">=</span>dfPlot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">'Dim1'</span>, y<span class="op">=</span><span class="st">'Dim2'</span>, hue<span class="op">=</span><span class="st">'Claim'</span>, palette<span class="op">=</span><span class="st">'tab20'</span>, data<span class="op">=</span>dfPlot[dfPlot[<span class="st">"Epoch"</span>] <span class="op">==</span> <span class="bu">max</span>(dfPlot[<span class="st">"Epoch"</span>])])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-10" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> NearestNeighbors</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>nbrs <span class="op">=</span> NearestNeighbors(n_neighbors<span class="op">=</span><span class="dv">3</span>, algorithm<span class="op">=</span><span class="st">'ball_tree'</span>).fit(dfPlot[dfPlot[<span class="st">"Epoch"</span>] <span class="op">==</span> <span class="bu">max</span>(dfPlot[<span class="st">"Epoch"</span>])][[<span class="st">"Dim1"</span>, <span class="st">"Dim2"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-11" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>distances, indices <span class="op">=</span> nbrs.kneighbors(dfPlot[dfPlot[<span class="st">"Epoch"</span>] <span class="op">==</span> <span class="bu">max</span>(dfPlot[<span class="st">"Epoch"</span>])][[<span class="st">"Dim1"</span>, <span class="st">"Dim2"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-12" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(indices.shape[<span class="dv">0</span>]):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>([lTargetStrings[i] <span class="cf">for</span> i <span class="kw">in</span> indices[i, :].tolist()])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Boost Your Immunity with Every Spoonful.', 'Strengthen Your Gut with Live Cultures.', 'Heavenly Taste in Every Spoonful.']
['Packed with Probiotics for a Healthier You.', 'Feel Energized with Protein-Rich Yoghurt.', 'Daily Dose of Calcium for Strong Bones.']
['Nourish Your Body with Natural Goodness.', 'Gourmet Flavors to Satisfy Your Cravings.', 'Supports Heart Health with Omega-3s.']
['Strengthen Your Gut with Live Cultures.', 'Boost Your Immunity with Every Spoonful.', 'Experience the Silky Smooth Perfection.']
['Low in Sugar, High in Vital Nutrients.', 'Rich, Velvety Texture in Every Bite.', 'Treat Your Taste Buds to Luxurious Bliss.']
['Daily Dose of Calcium for Strong Bones.', 'Packed with Probiotics for a Healthier You.', 'Gourmet Flavors to Satisfy Your Cravings.']
['Feel Energized with Protein-Rich Yoghurt.', 'Packed with Probiotics for a Healthier You.', 'Gourmet Flavors to Satisfy Your Cravings.']
['Healthy Digestion Starts Here.', 'Treat Your Taste Buds to Luxurious Bliss.', 'Taste the Burst of Real Fruit Flavor.']
['Antioxidant-Rich for a Balanced Diet.', 'Healthy Digestion Starts Here.', 'Savor the Freshness of Farm-Fresh Ingredients.']
['Supports Heart Health with Omega-3s.', 'Savor the Freshness of Farm-Fresh Ingredients.', 'Nourish Your Body with Natural Goodness.']
['Indulge in Creamy Delight.', 'Pure Decadence Without the Guilt.', 'Daily Dose of Calcium for Strong Bones.']
['Rich, Velvety Texture in Every Bite.', 'Treat Your Taste Buds to Luxurious Bliss.', 'Low in Sugar, High in Vital Nutrients.']
['Taste the Burst of Real Fruit Flavor.', 'Treat Your Taste Buds to Luxurious Bliss.', 'Healthy Digestion Starts Here.']
['Pure Decadence Without the Guilt.', 'Packed with Probiotics for a Healthier You.', 'Indulge in Creamy Delight.']
['Experience the Silky Smooth Perfection.', 'Indulge in Creamy Delight.', 'Pure Decadence Without the Guilt.']
['Savor the Freshness of Farm-Fresh Ingredients.', 'Supports Heart Health with Omega-3s.', 'Indulge in Creamy Delight.']
['Gourmet Flavors to Satisfy Your Cravings.', 'Daily Dose of Calcium for Strong Bones.', 'Nourish Your Body with Natural Goodness.']
['Deliciously Tangy, Perfectly Sweet.', 'Rich, Velvety Texture in Every Bite.', 'Antioxidant-Rich for a Balanced Diet.']
['Treat Your Taste Buds to Luxurious Bliss.', 'Taste the Burst of Real Fruit Flavor.', 'Healthy Digestion Starts Here.']
['Heavenly Taste in Every Spoonful.', 'Indulge in Creamy Delight.', 'Experience the Silky Smooth Perfection.']</code></pre>
</div>
</div>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>lTargetStrings[<span class="dv">12</span>], lTargetStrings[<span class="dv">18</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="106">
<pre><code>('Taste the Burst of Real Fruit Flavor.',
 'Treat Your Taste Buds to Luxurious Bliss.')</code></pre>
</div>
</div>
<div id="cell-14" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>lTargetStrings[<span class="dv">1</span>], lTargetStrings[<span class="dv">7</span>], lTargetStrings[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>('Packed with Probiotics for a Healthier You.',
 'Healthy Digestion Starts Here.',
 'Daily Dose of Calcium for Strong Bones.')</code></pre>
</div>
</div>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>lTargetStrings[<span class="dv">3</span>], lTargetStrings[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="108">
<pre><code>('Strengthen Your Gut with Live Cultures.',
 'Boost Your Immunity with Every Spoonful.',
 'Daily Dose of Calcium for Strong Bones.')</code></pre>
</div>
</div>
<div id="cell-16" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">'Dim1'</span>, y<span class="op">=</span><span class="st">'Dim2'</span>, hue<span class="op">=</span><span class="st">'Epoch'</span>, data<span class="op">=</span>dfPlot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming dfPlot is your DataFrame and iClaim contains the maximum value of 'Claim'</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.FacetGrid(dfPlot[dfPlot[<span class="st">'Claim'</span>] <span class="op">&lt;=</span> iClaims], col<span class="op">=</span><span class="st">"Claim"</span>, col_wrap<span class="op">=</span><span class="dv">4</span>, sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>g.map_dataframe(sns.scatterplot, x<span class="op">=</span><span class="st">'Dim1'</span>, y<span class="op">=</span><span class="st">'Dim2'</span>, hue<span class="op">=</span><span class="st">'Epoch'</span>, hue_norm<span class="op">=</span>(<span class="bu">min</span>(dfPlot[<span class="st">'Epoch'</span>]), <span class="bu">max</span>(dfPlot[<span class="st">'Epoch'</span>])), palette <span class="op">=</span> <span class="st">'flare'</span>, marker <span class="op">=</span> <span class="st">"o"</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the legend for clarity</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>g.add_legend()</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">#g.set(xlim=(-8, 2), ylim=(-2, 8))</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plots</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-18" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">'Dim1'</span>, y<span class="op">=</span><span class="st">'Dim2'</span>, hue <span class="op">=</span> <span class="st">"Claim"</span>, data<span class="op">=</span>dfPlot, palette<span class="op">=</span><span class="st">'tab20'</span>, size <span class="op">=</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/hoener/miniforge3/envs/mphil/lib/python3.9/site-packages/seaborn/_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context('mode.use_inf_as_na', True):
/Users/hoener/miniforge3/envs/mphil/lib/python3.9/site-packages/seaborn/_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context('mode.use_inf_as_na', True):</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-20-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming dfPlot is your DataFrame and iClaim contains the maximum value of 'Claim'</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.FacetGrid(dfPlot[dfPlot[<span class="st">'Claim'</span>] <span class="op">&lt;=</span> iClaims], col<span class="op">=</span><span class="st">"Claim"</span>, col_wrap<span class="op">=</span><span class="dv">4</span>, sharex<span class="op">=</span><span class="va">False</span>, sharey<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>g.map_dataframe(sns.scatterplot, x<span class="op">=</span><span class="st">'Dim1'</span>, y<span class="op">=</span><span class="st">'Dim2'</span>, hue<span class="op">=</span><span class="st">'NLL'</span>, marker <span class="op">=</span> <span class="st">"o"</span>, palette <span class="op">=</span> <span class="st">'flare'</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the legend for clarity</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>g.add_legend()</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">#g.set(xlim=(-8, 2), ylim=(-2, 8))</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plots</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-21-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-20" class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming dfPlot is your DataFrame and iClaim contains the maximum value of 'Claim'</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.FacetGrid(dfPlot[(dfPlot[<span class="st">'Epoch'</span>] <span class="op">&gt;=</span> <span class="dv">150</span>) <span class="op">&amp;</span> (dfPlot[<span class="st">'Epoch'</span>] <span class="op">&lt;=</span> <span class="dv">170</span>)], col<span class="op">=</span><span class="st">"Claim"</span>, col_wrap<span class="op">=</span><span class="dv">4</span>, sharex<span class="op">=</span><span class="va">False</span>, sharey<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>g.map_dataframe(sns.scatterplot, x<span class="op">=</span><span class="st">'Dim1'</span>, y<span class="op">=</span><span class="st">'Dim2'</span>, hue<span class="op">=</span><span class="st">'NLL'</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the legend for clarity</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>g.add_legend()</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plots</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-21" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>plt.plot(aEmbedsOld[:, <span class="dv">0</span>], aEmbedsOld[:, <span class="dv">1</span>], <span class="st">'.'</span>, c <span class="op">=</span> <span class="st">"black"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>plt.plot(aEmbeds[:, <span class="dv">0</span>], aEmbeds[:, <span class="dv">1</span>], <span class="st">'.'</span>, c <span class="op">=</span> <span class="st">"red"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>plt.plot(aEmbedsNew[:, <span class="dv">0</span>], aEmbedsNew[:, <span class="dv">1</span>], <span class="st">'.'</span>, c <span class="op">=</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-23-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-22" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ForwardPass(tOHETarget, tInputEmbeddings, tTarget, llm, ae, iBatchSize):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>        tSummaryEmbedding <span class="op">=</span> ae(tOHETarget).unsqueeze(<span class="dv">1</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>        tInputs <span class="op">=</span> torch.cat([tSummaryEmbedding, tInputEmbeddings], dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span><span class="al">NOTE</span><span class="co">: Necessary to keep making use of batching of the LLM, otherwise runs sequential ...</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> torch.tensor([<span class="dv">0</span>], dtype<span class="op">=</span>torch.float32, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, b <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">range</span>(<span class="dv">0</span>, iClaims, iBatchSize)):</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>            <span class="co"># </span><span class="al">NOTE</span><span class="co">: What if we exceed dim?, unit test</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>            out <span class="op">=</span> llm(inputs_embeds <span class="op">=</span> tInputs[b:((i <span class="op">+</span> <span class="dv">1</span>)<span class="op">*</span>iBatchSize), :, :], labels<span class="op">=</span>tTarget[b:((i <span class="op">+</span> <span class="dv">1</span>)<span class="op">*</span>iBatchSize), :])</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> loss <span class="op">+</span> out[<span class="dv">0</span>]</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> out</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> loss.item() <span class="co"># use item() to save memory</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-23" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> EditParameters(dValue, tAEParam, i <span class="op">=</span> <span class="va">None</span>, j <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> j <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>        tAEParam.data[i, j] <span class="op">+=</span> dValue</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> i <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        tAEParam.data[i] <span class="op">+=</span> dValue</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        tAEParam.data <span class="op">+=</span> dValue</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(tAEParam.data)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ResetParameters(dValue, tAEParam, i <span class="op">=</span> <span class="va">None</span>, j <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> j <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        tAEParam.data[i, j] <span class="op">-=</span> dValue</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> i <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>        tAEParam.data[i] <span class="op">-=</span> dValue</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        tAEParam.data <span class="op">-=</span> dValue</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> RangeForwardPass(vRange, tAEParam, AE, i, j, fnForwardPass):</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    vRangeLoss <span class="op">=</span> torch.ones(vRange.shape[<span class="dv">0</span>]) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r, R <span class="kw">in</span> <span class="bu">enumerate</span>(vRange):</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>        EditParameters(R, tAEParam, i, j)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>        vRangeLoss[r] <span class="op">=</span> fnForwardPass(AE)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>        ResetParameters(R, tAEParam, i, j)</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vRangeLoss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-24" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> copy</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> EvaluateLL(tAEParam, AE, vRange, fnForwardPass):</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tAEParam.dim() <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        tEval <span class="op">=</span> torch.ones((vRange.size(<span class="dv">0</span>), tAEParam.shape[<span class="dv">0</span>], tAEParam.shape[<span class="dv">1</span>])) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(tAEParam.shape[<span class="dv">0</span>])):</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(tAEParam.shape[<span class="dv">1</span>]):</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>                tEval[:, i, j] <span class="op">=</span> RangeForwardPass(vRange, tAEParam, AE, i, j, fnForwardPass)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> tAEParam.dim() <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        tEval <span class="op">=</span> torch.ones((vRange.size(<span class="dv">0</span>), tAEParam.shape[<span class="dv">0</span>])) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(tAEParam.shape[<span class="dv">0</span>])):</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>            tEval[:, i] <span class="op">=</span> RangeForwardPass(vRange, tAEParam, AE, i, <span class="va">None</span>, fnForwardPass)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>        tEval <span class="op">=</span> RangeForwardPass(vRange, tAEParam, AE, <span class="va">None</span>, <span class="va">None</span>, fnForwardPass)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tEval</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ManipulateAE(AE, tAEParam, vRange, sParameters, fnForwardPass):</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> sParameters <span class="op">==</span> <span class="st">"EncoderWeights"</span>:</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">#tAEParam = AEEdit.encoder[0].weight</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>        tEval <span class="op">=</span> EvaluateLL(tAEParam, AE, vRange, fnForwardPass)</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> sParameters <span class="op">==</span> <span class="st">"DecoderWeights"</span>:</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">#tAEParam = AEEdit.decoder[0].weight</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>        tEval <span class="op">=</span> EvaluateLL(tAEParam, AE, vRange, fnForwardPass)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> sParameters <span class="op">==</span> <span class="st">"EncoderBias"</span>:</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">#tAEParam = AEEdit.encoder[0].bias</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>        tEval <span class="op">=</span> EvaluateLL(tAEParam, AE, vRange, fnForwardPass)</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> sParameters <span class="op">==</span> <span class="st">"DecoderBias"</span>:</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">#tAEParam = AEEdit.decoder[0].bias</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>        tEval <span class="op">=</span> EvaluateLL(tAEParam, AE, vRange, fnForwardPass)</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Invalid parameter"</span>)</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tEval</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-25" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fnForwardPass <span class="op">=</span> <span class="kw">lambda</span> x: ForwardPass(tOHETarget, tInputEmbeddings, tTarget, model, x, iBatchSize)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>tStepEncoderWeight</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>tStepDecoderWeight</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>tStepEncoderBias</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>tStepDecoderBias</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>tensor([ 1.4640e-03,  3.5267e-03,  3.0165e-03,  2.6088e-02,  2.4521e-03,
        -1.0252e-02,  1.6544e-02, -2.8253e-03, -1.2948e-02,  6.4287e-03,
         1.4810e-02,  2.0447e-02,  4.7547e-03,  9.6371e-03, -1.0789e-02,
         3.2268e-03, -7.2267e-03, -1.5679e-03,  6.1918e-03, -1.2937e-02,
        -5.2952e-03,  2.9024e-02,  8.5549e-03, -1.1833e-02, -1.5130e-02,
        -5.9009e-04, -1.7962e-02,  5.8959e-03, -4.7182e-03, -6.4416e-03,
        -2.3169e-02,  1.5288e-03, -1.4387e-02,  7.9461e-03, -1.1707e-02,
         7.7653e-03, -4.1027e-03,  3.8502e-02,  2.1473e-03,  5.4154e-03,
         8.2672e-03, -2.0474e-04, -2.4662e-02,  9.2947e-04,  8.5819e-04,
        -1.4823e-02, -2.8620e-02, -3.2306e-03, -2.0807e-02,  3.0469e-02,
         2.0183e-02,  1.1577e-02,  5.3539e-03, -9.3131e-03, -1.5606e-02,
         2.1378e-02, -3.2605e-03, -9.3132e-03,  1.5685e-02, -2.3335e-03,
         8.8972e-03, -1.2372e-02, -1.8719e-02, -1.2946e-03,  9.3160e-03,
         1.1614e-02, -2.8869e-03,  1.2608e-03, -5.1525e-02,  1.2521e-02,
        -1.3119e-02,  4.3507e-03,  6.0827e-03,  2.7442e-03, -2.6789e-03,
         1.9124e-02, -2.9263e-02,  2.0510e-03,  3.4853e-03, -2.4860e-02,
        -6.2923e-03, -4.0281e-03, -1.8615e-02, -9.2120e-03, -2.4160e-02,
        -1.1081e-03, -6.0220e-03, -2.2602e-03, -4.5787e-03, -3.2840e-03,
        -1.0512e-03,  8.1277e-04, -3.6687e-02,  4.1738e-03, -2.8399e-02,
        -7.7077e-03,  1.5489e-02,  2.8032e-03, -9.3054e-03,  8.1182e-03,
         7.7199e-03, -1.9014e-03, -1.4355e-03,  2.2970e-03,  2.7989e-02,
        -5.6636e-03, -2.7284e-02,  1.4947e-02,  6.0429e-03, -1.5481e-02,
        -7.4011e-04,  3.6407e-03, -3.3187e-03,  2.1021e-02,  5.4762e-04,
         5.5054e-03, -2.3129e-02, -8.2214e-03,  4.2946e-02, -1.9243e-03,
        -9.3163e-03, -4.8388e-03, -1.9907e-02, -2.5447e-02,  1.7650e-02,
        -5.3694e-03,  1.0070e-03, -4.7971e-03, -1.6093e-02,  2.1368e-04,
         1.0283e-02,  3.0703e-02, -5.1730e-03, -2.8066e-03,  6.0326e-03,
         2.2900e-02, -1.6282e-03,  5.9897e-03,  1.1573e-02, -8.8763e-04,
         4.6372e-03,  4.9552e-03, -2.0725e-02, -1.5471e-02, -3.8066e-02,
        -3.2467e-03,  4.8788e-03,  7.1456e-03,  5.8597e-03,  5.4404e-03,
         7.4224e-03, -9.1338e-03, -1.0353e-02,  1.3183e-02,  1.0778e-02,
        -2.3277e-02,  1.2836e-02, -1.3563e-02, -2.3765e-02, -6.2326e-03,
        -1.4492e-02,  1.1342e-02,  9.1707e-03, -1.4025e-04,  2.9093e-04,
         2.7618e-02,  1.3939e-02,  2.9720e-02, -2.7670e-02, -1.7206e-02,
         3.8533e-02, -1.7184e-02,  1.0213e-03,  8.2309e-03,  1.0663e-02,
         1.0792e-02, -7.7685e-03, -1.8324e-03, -5.5695e-04, -1.3300e-02,
        -2.9527e-03,  2.3823e-02,  5.2508e-03,  7.3709e-03, -2.2459e-02,
         1.5080e-02,  1.0120e-02, -5.3036e-03,  9.8963e-03, -4.1111e-04,
        -1.1516e-03,  5.9404e-03, -6.8431e-03,  3.4969e-03,  1.7917e-02,
         1.2948e-03,  1.0226e-02, -1.3241e-02, -1.0827e-02, -1.2205e-02,
         7.0604e-03,  2.3755e-03,  4.7864e-03, -7.1156e-03,  1.3864e-02,
        -8.3861e-03, -3.0835e-03, -1.2083e-02, -4.3823e-03,  9.5916e-03,
        -2.0998e-02,  1.0022e-02,  8.8330e-03,  2.1726e-02, -2.3159e-02,
         1.0412e-02,  1.1933e-02, -1.2425e-02,  6.4882e-03, -2.9414e-03,
        -2.0089e-02, -1.6396e-02, -9.5668e-03, -8.1542e-03,  6.7486e-03,
        -2.9060e-02,  1.0195e-02, -5.1831e-03, -6.1536e-03, -1.4644e-02,
         4.8781e-03, -4.7584e-03,  5.6098e-03, -2.9467e-03, -3.0430e-03,
        -3.0814e-02, -1.3947e-02,  3.9095e-03,  1.0107e-02,  3.8093e-03,
         6.1617e-03, -7.4779e-03,  7.2968e-03,  1.4148e-02,  2.6724e-03,
        -2.3906e-02,  8.2791e-04, -7.9069e-03,  1.6604e-02, -1.9821e-02,
        -1.0012e-02,  2.8670e-05, -5.9438e-04,  1.3134e-02, -2.1727e-02,
         1.5620e-02, -8.8838e-03,  1.5505e-02,  1.0244e-02,  4.6397e-03,
         4.1390e-03,  3.7193e-05,  1.3813e-02,  7.2118e-03, -9.8178e-03,
        -1.6032e-02,  8.9569e-03,  4.9855e-03,  2.3830e-02, -5.3461e-03,
         2.3930e-02,  1.3559e-02, -9.9317e-03,  8.4736e-03,  6.3896e-04,
        -1.2428e-02,  1.8051e-02, -2.7003e-03,  2.1048e-02, -1.1782e-02,
         1.7510e-03, -1.9337e-02, -1.2749e-02,  1.7985e-02, -1.1756e-02,
         9.6245e-04, -1.3500e-02,  2.5646e-02, -2.3655e-02,  1.3107e-02,
         2.8625e-05,  6.5326e-03,  8.6951e-04,  3.7353e-02,  1.8361e-02,
         4.0114e-02,  1.8468e-03,  1.3869e-02,  1.1589e-02, -2.5186e-02,
         7.5280e-03, -2.1322e-03, -5.1165e-03, -2.6435e-02, -1.7120e-02,
        -1.3943e-03, -2.0034e-02,  1.1334e-02, -2.5123e-03,  4.4245e-03,
        -9.1640e-03,  2.4725e-02, -2.1496e-02, -2.3351e-02,  1.1809e-02,
         3.0408e-02,  8.6213e-03,  2.0828e-02,  7.6681e-03,  8.6033e-03,
        -3.1315e-02,  1.0618e-02,  9.5463e-03, -2.2000e-03, -1.3052e-02,
        -1.0066e-02, -1.3861e-02, -9.2831e-03,  2.0747e-03, -1.1961e-02,
        -3.7684e-03,  9.0250e-03,  1.5468e-02, -3.8166e-03, -3.6844e-03,
        -2.6057e-02,  5.8071e-03, -1.7970e-03,  2.4957e-02, -1.1438e-02,
        -6.9342e-03, -1.9053e-02,  2.2378e-02, -7.9185e-03, -1.0447e-02,
        -2.4938e-02, -5.9829e-03,  4.0727e-03,  4.4745e-04,  5.1527e-03,
        -4.0322e-03,  9.8119e-03, -2.6426e-02, -1.7777e-02, -3.0259e-02,
        -3.5115e-03, -1.2443e-02, -2.1382e-03, -1.6876e-03,  1.4393e-02,
         8.7925e-03, -2.0467e-02,  5.0961e-02, -2.6290e-03,  1.6666e-02,
        -2.2227e-02, -1.1247e-02, -3.1544e-02, -9.6684e-03, -7.1439e-03,
         1.2808e-02,  7.4482e-03, -4.0486e-03,  1.0665e-02, -2.3799e-02,
         1.5954e-02, -5.7473e-03, -1.9772e-02, -2.3533e-02, -1.0003e-02,
        -1.9567e-02,  1.0240e-02, -1.4439e-02,  3.5766e-03,  1.1205e-02,
         1.7221e-02,  1.3639e-03,  8.2348e-03,  1.8834e-02, -2.1027e-03,
         1.7994e-02,  4.4616e-03, -6.6751e-03, -1.5186e-02,  1.3456e-03,
        -3.1331e-04, -2.2605e-02, -7.4288e-04,  6.0796e-03,  5.4693e-03,
        -6.9773e-03,  2.2482e-03, -1.2166e-02, -2.5543e-02,  1.6115e-02,
        -7.5711e-04, -2.7670e-02,  1.6309e-03, -1.2038e-03,  1.3118e-02,
         2.2882e-02, -1.4913e-02, -2.0483e-02, -1.2759e-02, -4.6758e-02,
         2.2528e-03, -7.6982e-03, -5.3231e-03,  8.9313e-03, -2.1651e-03,
         1.6767e-02, -1.8048e-02, -9.6531e-03, -1.3814e-02, -1.3031e-02,
        -1.0157e-02,  1.7376e-02, -1.6791e-02,  1.4479e-02, -3.0464e-02,
         1.0805e-02,  1.0212e-02, -7.9187e-03,  1.9848e-02, -7.0177e-03,
         4.0279e-02, -4.2045e-03,  1.3487e-02,  1.8471e-03,  3.1748e-02,
         1.4959e-02,  1.7343e-02, -8.5949e-03,  2.3404e-02,  2.3620e-02,
         1.8414e-02, -3.6650e-03, -2.0118e-03, -3.7539e-03, -7.2248e-03,
        -7.7837e-03,  4.8286e-03,  1.9413e-02,  1.5844e-03,  9.0510e-03,
         7.6543e-03,  3.6457e-03, -5.6307e-03,  2.5663e-03, -7.3553e-03,
        -1.0110e-02,  1.2954e-02,  1.1226e-03, -1.2954e-02, -2.9211e-03,
        -6.3491e-04, -5.6823e-03, -1.3193e-02, -3.9121e-03, -1.7432e-03,
        -1.7206e-02,  3.3742e-03,  2.2098e-02, -1.1715e-02, -9.1839e-04,
        -1.3998e-02,  1.2554e-02,  3.6017e-03,  3.4771e-02, -9.4349e-03,
         4.9770e-03,  8.8192e-03, -1.5637e-02, -6.7949e-03, -2.3816e-02,
        -1.2670e-03, -1.5322e-03,  1.9242e-02,  1.1543e-02,  9.2916e-03,
        -3.4544e-02, -6.9413e-03,  1.4995e-02, -3.4951e-03, -1.8416e-02,
         3.3537e-03, -8.6637e-03, -7.4384e-03,  2.3480e-02, -2.0787e-02,
        -3.2634e-03, -2.0272e-02, -1.1149e-02, -2.4877e-02,  2.6152e-02,
        -1.1446e-02,  1.1690e-02,  1.2316e-02,  3.5417e-03,  1.9355e-02,
         2.6440e-02,  9.5280e-03,  1.4302e-03, -4.4944e-03,  1.4566e-03,
        -1.2637e-02,  7.7502e-03, -2.3290e-02, -2.2103e-02,  9.3820e-03,
        -2.2771e-02, -1.2756e-02,  2.0928e-02, -3.8334e-03,  5.5551e-03,
        -2.0367e-02, -5.2040e-03, -2.8914e-02, -1.7757e-03, -5.1607e-03,
         2.8307e-02,  2.1601e-02,  1.3852e-02,  5.7467e-03, -2.6169e-03,
         1.3838e-02,  1.1009e-02, -4.1002e-03,  1.0077e-02, -1.0679e-02,
        -3.9958e-03,  1.3430e-02, -1.3988e-02, -1.3447e-02,  2.9595e-02,
        -1.7353e-02,  1.7247e-03, -2.4459e-03, -2.3094e-02, -1.4619e-02,
        -2.8344e-03, -9.2372e-03,  1.6900e-02,  2.2222e-02,  1.5780e-02,
        -1.0853e-02,  6.4000e-03,  9.0133e-03, -1.4392e-02, -2.9974e-02,
        -1.9137e-02, -4.5623e-03, -8.9388e-03,  1.2598e-02,  2.5207e-02,
         5.8686e-03, -1.2623e-02, -9.7860e-03, -7.0548e-04,  8.7215e-03,
         6.8361e-03, -7.8646e-03,  2.2928e-02, -3.5703e-02, -1.0215e-02,
        -5.6103e-03,  2.5984e-02,  3.3704e-03, -7.3442e-03,  7.7864e-04,
         2.2475e-03,  1.5561e-02, -8.6187e-03,  2.0942e-02,  1.3567e-02,
        -9.0970e-03,  9.7480e-03,  8.1712e-03,  8.2642e-03, -1.9194e-02,
        -4.9154e-03, -1.4059e-02, -7.6807e-03, -1.3765e-03,  9.1379e-03,
         3.3745e-02, -2.4590e-02, -1.4837e-02,  1.8997e-02,  1.0520e-02,
        -1.3474e-02,  4.9339e-02, -1.2532e-02, -5.4829e-03,  8.5125e-03,
         8.8103e-03,  7.5890e-03, -6.2257e-03, -2.0319e-02, -1.7290e-02,
         1.2680e-03,  1.0551e-02, -1.2838e-02, -2.3282e-02, -1.9008e-02,
         2.1507e-03, -6.1102e-03,  1.6141e-02, -1.6164e-02,  3.3681e-03,
         9.9813e-03,  1.2662e-02,  5.3673e-03,  7.0478e-03,  4.0912e-03,
        -4.4698e-03, -1.7258e-02, -2.3270e-02,  1.3298e-02,  2.2395e-02,
         9.5345e-03, -2.0975e-02,  8.2834e-03, -3.5924e-02, -6.7704e-03,
        -1.7999e-02, -1.0843e-02, -3.2734e-02, -1.9738e-02,  1.0493e-02,
         1.2708e-03, -3.1972e-02,  1.3952e-02,  1.5911e-02, -1.6201e-03,
        -7.9886e-03, -2.2525e-02,  1.9750e-02,  1.9717e-02, -1.8187e-02,
         1.8591e-02,  2.9359e-03,  2.0253e-02,  1.7523e-02,  1.2273e-02,
        -2.2473e-02, -1.4245e-02,  7.9443e-03, -1.5005e-02,  2.2182e-02,
        -3.8865e-03,  2.2436e-02, -3.4730e-03,  1.6613e-02, -1.5658e-02,
         1.5109e-03, -1.9572e-02, -1.4931e-02,  6.4715e-03, -1.3846e-04,
         2.6829e-02, -1.9421e-02, -3.2731e-02,  2.4479e-02, -3.0595e-02,
        -2.0839e-02,  9.2684e-03, -4.4410e-03,  8.1786e-03, -8.5665e-03,
         1.3098e-02, -1.4162e-02,  1.9252e-02,  7.0922e-03,  1.0571e-02,
        -2.1241e-02,  6.6856e-03,  2.1539e-02, -4.0653e-03, -2.6066e-02,
        -2.4327e-02, -5.2849e-03, -1.3473e-02, -2.7070e-03, -8.1603e-03,
         7.2589e-03, -1.1435e-03,  1.6975e-02,  9.7926e-03,  9.8209e-03,
         1.3861e-02, -2.2433e-02,  2.5472e-02, -6.3643e-03,  2.4387e-02,
         4.9862e-03, -5.7015e-03, -6.2082e-03, -1.4938e-02, -3.4034e-04,
         8.3200e-03,  2.7920e-02, -1.1479e-02, -6.3176e-03,  9.8635e-03,
         1.1287e-02,  9.7145e-03,  2.2181e-02, -8.3961e-03,  1.2682e-03,
         3.3014e-02, -1.0268e-02,  7.6613e-03,  1.9887e-02,  2.5292e-02,
         4.3373e-03,  2.5421e-02,  1.0480e-02,  2.3107e-02,  2.3666e-02,
        -3.4859e-03,  1.4937e-02,  2.9630e-02,  8.9792e-03, -1.4391e-03,
        -1.1391e-02, -2.6023e-02,  2.3454e-02,  1.4505e-03,  9.9773e-03,
        -1.0483e-02, -3.8440e-03,  7.3380e-03,  2.1303e-02, -9.3193e-03,
         2.5449e-02, -2.4884e-02, -8.4417e-03,  1.7804e-03, -5.2680e-03,
        -7.9650e-04, -6.3930e-03,  9.8526e-04,  6.1089e-03, -5.4455e-03,
         1.2850e-02, -9.4817e-03, -7.9001e-03,  4.2908e-03,  6.1679e-03,
         1.3162e-02, -2.4014e-03, -1.9323e-02, -1.2329e-02, -1.2393e-02,
        -7.8400e-03,  2.2723e-02,  2.1702e-02], device='mps:0')</code></pre>
</div>
</div>
<div id="cell-27" class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>tStepEncoderWeight</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>tensor([[ 0.0231, -0.0065, -0.0069,  0.0023, -0.0065, -0.0201,  0.0101, -0.0130,
          0.0028, -0.0031,  0.0056, -0.0129, -0.0034, -0.0154, -0.0007,  0.0117,
         -0.0101, -0.0027, -0.0177, -0.0207],
        [-0.0086,  0.0048,  0.0062, -0.0276, -0.0010, -0.0097,  0.0070, -0.0026,
          0.0031, -0.0026, -0.0004, -0.0229,  0.0051,  0.0130, -0.0058,  0.0032,
          0.0107, -0.0055, -0.0103,  0.0027]], device='mps:0')</code></pre>
</div>
</div>
<div id="cell-28" class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># likeinhood for iEpoch and iEpoch + 1</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>fnForwardPass(ae), fnForwardPass(ae_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>(1.0270086526870728, 1.4227309226989746)</code></pre>
</div>
</div>
<div id="cell-29" class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># can replicate the spike like this, as long as ae is not changed beforehand</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>aeCopy <span class="op">=</span> copy.deepcopy(ae)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>aeCopy.encoder[<span class="dv">0</span>].weight.data <span class="op">=</span> ae.encoder[<span class="dv">0</span>].weight.data <span class="op">+</span> tStepEncoderWeight</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>aeCopy.encoder[<span class="dv">0</span>].bias.data <span class="op">=</span> ae.encoder[<span class="dv">0</span>].bias.data <span class="op">+</span> tStepEncoderBias</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>aeCopy.decoder[<span class="dv">0</span>].weight.data <span class="op">=</span> ae.decoder[<span class="dv">0</span>].weight.data <span class="op">+</span> tStepDecoderWeight</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>aeCopy.decoder[<span class="dv">0</span>].bias.data <span class="op">=</span> ae.decoder[<span class="dv">0</span>].bias.data <span class="op">+</span> tStepDecoderBias</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-30" class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>tLL <span class="op">=</span> torch.empty_like(tStepEncoderWeight)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>tLL</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>tensor([[0.0000e+00, 1.4013e-45, 0.0000e+00, 3.5873e-43, 9.1835e-41, 2.3694e-38,
         2.3510e-38, 2.3510e-38, 1.4013e-45, 3.6013e-43, 0.0000e+00, 0.0000e+00,
         0.0000e+00, 2.3694e-38, 3.6013e-43, 0.0000e+00, 0.0000e+00, 0.0000e+00,
         2.3694e-38, 1.4013e-45],
        [0.0000e+00, 0.0000e+00, 2.3694e-38, 2.3694e-38, 0.0000e+00, 0.0000e+00,
         0.0000e+00, 2.3694e-38, 9.2196e-41, 0.0000e+00, 0.0000e+00, 2.3694e-38,
         2.3694e-38, 3.6013e-43, 0.0000e+00, 0.0000e+00, 2.3694e-38, 2.3694e-38,
         1.4013e-45, 0.0000e+00]], device='mps:0')</code></pre>
</div>
</div>
<div id="cell-31" class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>tStepEncoderBias.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>torch.Size([2])</code></pre>
</div>
</div>
<div id="cell-32" class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>ae.<span class="bu">eval</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>Autoencoder(
  (encoder): Sequential(
    (0): Linear(in_features=20, out_features=2, bias=True)
  )
  (decoder): Sequential(
    (0): Linear(in_features=2, out_features=768, bias=True)
  )
)</code></pre>
</div>
</div>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>tLLEncoderBias <span class="op">=</span> torch.empty_like(tStepEncoderBias)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>aeCopy <span class="op">=</span> ae</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(tStepEncoderBias.shape[<span class="dv">0</span>])):</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>):</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># reset the parameters</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>        aeCopy <span class="op">=</span> copy.deepcopy(ae)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># edit the parameters</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>        aeCopy.encoder[<span class="dv">0</span>].bias.data[i] <span class="op">=</span> ae.encoder[<span class="dv">0</span>].bias.data[i] <span class="op">+</span> tStepEncoderBias[i]</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># calculate the likelihh</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>        tLLEncoderBias[i] <span class="op">=</span> fnForwardPass(aeCopy)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>  0%|          | 0/2 [00:00&lt;?, ?it/s]huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
    - Avoid using `tokenizers` before the fork if possible
    - Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
100%|██████████| 2/2 [00:00&lt;00:00,  5.06it/s]</code></pre>
</div>
</div>
<div id="cell-34" class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>tLLDecoderBias <span class="op">=</span> torch.empty_like(tStepDecoderBias)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>aeCopy <span class="op">=</span> ae</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(tStepDecoderBias.shape[<span class="dv">0</span>])):</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>):</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># reset the parameters</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>        aeCopy <span class="op">=</span> copy.deepcopy(ae)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># edit the parameters</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>        aeCopy.decoder[<span class="dv">0</span>].bias.data[i] <span class="op">=</span> ae.decoder[<span class="dv">0</span>].bias.data[i] <span class="op">+</span> tStepDecoderBias[i]</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># calculate the likelihh</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        tLLDecoderBias[i] <span class="op">=</span> fnForwardPass(aeCopy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 768/768 [01:41&lt;00:00,  7.55it/s]</code></pre>
</div>
</div>
<div id="cell-35" class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>tLLEncoderWeight <span class="op">=</span> torch.empty_like(tStepEncoderWeight)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>aeCopy <span class="op">=</span> ae</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>aeCopy.<span class="bu">eval</span>()</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(tStepEncoderBias.shape[<span class="dv">0</span>])):</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(tStepEncoderWeight.shape[<span class="dv">1</span>]):</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># reset the parameters</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>        aeCopy <span class="op">=</span> copy.deepcopy(ae)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># edit the parameters</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>        aeCopy.encoder[<span class="dv">0</span>].weight.data[i, j] <span class="op">=</span> ae.encoder[<span class="dv">0</span>].weight.data[i, j] <span class="op">+</span> tStepEncoderWeight[i, j]</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># calculate the likelihh</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>        tLLEncoderWeight[i, j] <span class="op">=</span> fnForwardPass(aeCopy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 2/2 [00:05&lt;00:00,  2.59s/it]</code></pre>
</div>
</div>
<div id="cell-36" class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>tLLDecoderWeight <span class="op">=</span> torch.empty_like(tStepDecoderWeight)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>aeCopy <span class="op">=</span> ae</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>aeCopy.<span class="bu">eval</span>()</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(tStepDecoderWeight.shape[<span class="dv">0</span>])):</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(tStepDecoderWeight.shape[<span class="dv">1</span>]):</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># reset the parameters</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>        aeCopy <span class="op">=</span> copy.deepcopy(ae)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># edit the parameters</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>        aeCopy.decoder[<span class="dv">0</span>].weight.data[i, j] <span class="op">=</span> ae.decoder[<span class="dv">0</span>].weight.data[i, j] <span class="op">+</span> tStepDecoderWeight[i, j]</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># calculate the likelihh</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>        tLLDecoderWeight[i, j] <span class="op">=</span> fnForwardPass(aeCopy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 768/768 [03:21&lt;00:00,  3.82it/s]</code></pre>
</div>
</div>
<div id="cell-37" class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fnForwardPass(ae)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>1.0270086526870728</code></pre>
</div>
</div>
<div id="cell-38" class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> tLLDecoderWeight.detach().cpu().numpy()</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>, sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(a.shape[<span class="dv">1</span>]):</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    ax[i].plot(np.arange(a.shape[<span class="dv">0</span>]), a[:, i], <span class="st">'.'</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(<span class="ss">f"EncoderDim </span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    ax[i].set_xlabel(<span class="st">"ID Parameter"</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    ax[i].set_ylabel(<span class="st">"-LL"</span>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    ax[i].set_xticks(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">769</span>, <span class="dv">48</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-39" class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> tLLDecoderWeight.detach().cpu().numpy()</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">False</span>, sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(a.shape[<span class="dv">1</span>]):</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    ax[i].plot(np.arange(a.shape[<span class="dv">0</span>]), a[:, i], <span class="st">'.'</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(<span class="ss">f"EncoderDim </span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    ax[i].set_xlabel(<span class="st">"ID Parameter"</span>)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    ax[i].set_ylabel(<span class="st">"-LL"</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    ax[i].set_xticks(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">769</span>, <span class="dv">48</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-40" class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> tLLEncoderBias.detach().cpu().numpy()</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">5</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>, sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>ax.plot(np.arange(a.shape[<span class="dv">0</span>]), a, <span class="st">'.'</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f"Encoder Bias for EncodingDim 1 and EncodingDim 2"</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"ID Parameter"</span>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"-LL"</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-42-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-41" class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> tLLDecoderBias.detach().cpu().numpy()</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>, sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>ax.plot(np.arange(a.shape[<span class="dv">0</span>]), a, <span class="st">'.'</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f"Decoder Bias"</span>)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"ID Parameter"</span>)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"-LL"</span>)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">769</span>, <span class="dv">48</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-43-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-42" class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> tLLEncoderWeight.detach().cpu().numpy()</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>, sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(a.shape[<span class="dv">0</span>]):</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    ax[i].plot(np.arange(a.shape[<span class="dv">1</span>]), a[i, :], <span class="st">'.'</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(<span class="ss">f"EncoderDim </span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    ax[i].set_xlabel(<span class="st">"ID Parameter"</span>)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    ax[i].set_ylabel(<span class="st">"-LL"</span>)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    ax[i].set_xticks(<span class="bu">range</span>(<span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-44-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-43" class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>torch.<span class="bu">max</span>(tStepEncoderBias), torch.<span class="bu">min</span>(tStepEncoderBias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>(tensor(0.0328, device='mps:0'), tensor(-0.0713, device='mps:0'))</code></pre>
</div>
</div>
<div id="cell-44" class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>tRange <span class="op">=</span> torch.arange(<span class="op">-</span><span class="fl">0.08</span>, <span class="fl">0.08</span> <span class="op">+</span> <span class="fl">0.001</span>, <span class="fl">0.02</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>tRange</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>tensor([-0.0800, -0.0600, -0.0400, -0.0200,  0.0000,  0.0200,  0.0400,  0.0600,
         0.0800], device='mps:0')</code></pre>
</div>
</div>
<div id="cell-45" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> arange(dValue):</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    dStep <span class="op">=</span> dValue <span class="op">/</span> <span class="dv">10</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    tReturn <span class="op">=</span> torch.arange(<span class="dv">0</span>, dValue <span class="op">+</span> dStep, dStep)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tReturn.shape[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">12</span>:</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> tReturn[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tReturn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-46" class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>arange(tStepEncoderBias[i]), torch.ones(<span class="dv">11</span>) <span class="op">*</span> <span class="fl">1.6638</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="228">
<pre><code>(tensor([0.0000, 0.0033, 0.0066, 0.0098, 0.0131, 0.0164, 0.0197, 0.0230, 0.0262,
         0.0295, 0.0328], device='mps:0'),
 tensor([1.6638, 1.6638, 1.6638, 1.6638, 1.6638, 1.6638, 1.6638, 1.6638, 1.6638,
         1.6638, 1.6638], device='mps:0'))</code></pre>
</div>
</div>
<div id="cell-47" class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>aeNew <span class="op">=</span> Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>aeNew.load_state_dict(state_dict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>&lt;All keys matched successfully&gt;</code></pre>
</div>
</div>
<div id="cell-48" class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>AEEdit.encoder[<span class="dv">0</span>].bias.data[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>tensor(-1.7928, device='mps:0')</code></pre>
</div>
</div>
<div id="cell-49" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> EvalJointBias(tStepBias, sParameterID, ddParameterDict, fnAE):</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># joint steps</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>    ddParameterDictEdit <span class="op">=</span> copy.deepcopy(ddParameterDict)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    tStep <span class="op">=</span> torch.ones(arange(tStepBias[<span class="dv">0</span>]).shape[<span class="dv">0</span>], tStepBias.shape[<span class="dv">0</span>]) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(tStepBias.shape[<span class="dv">0</span>]):</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>        tStep[:, i] <span class="op">=</span> arange(tStepBias[i])</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>    tEval <span class="op">=</span> torch.ones((tStep.shape[<span class="dv">0</span>])) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, step <span class="kw">in</span> tqdm(<span class="bu">enumerate</span>(tStep)):</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>        ddParameterDictEdit <span class="op">=</span> copy.deepcopy(ddParameterDict)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>        ddParameterDictEdit[sParameterID] <span class="op">=</span> ddParameterDict[sParameterID] <span class="op">+</span> step</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>        AEEdit <span class="op">=</span> fnAE</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>        AEEdit.load_state_dict(ddParameterDictEdit)</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>        tEval[i] <span class="op">=</span> fnForwardPass(AEEdit)</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tEval, tStep</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> EvalMarginalBias(tStepBias, sParameterID, ddParameterDict, fnAE):</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># joint steps</span></span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>    ddParameterDictEdit <span class="op">=</span> copy.deepcopy(ddParameterDict)</span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>    tStep <span class="op">=</span> torch.ones(arange(tStepBias[<span class="dv">0</span>]).shape[<span class="dv">0</span>], tStepBias.shape[<span class="dv">0</span>]) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(tStepBias.shape[<span class="dv">0</span>]):</span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>        tStep[:, i] <span class="op">=</span> arange(tStepBias[i])</span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>    tEval <span class="op">=</span> torch.ones((tStep.shape[<span class="dv">0</span>]), tStepBias.shape[<span class="dv">0</span>]) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> tqdm(<span class="bu">range</span>(tStep.shape[<span class="dv">1</span>])):</span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, step <span class="kw">in</span> <span class="bu">enumerate</span>(tStep):</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>            ddParameterDictEdit <span class="op">=</span> copy.deepcopy(ddParameterDict)</span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>            ddParameterDictEdit[sParameterID][j] <span class="op">=</span> ddParameterDict[sParameterID][j] <span class="op">+</span> step[j]</span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>            AEEdit <span class="op">=</span> fnAE</span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a>            AEEdit.load_state_dict(ddParameterDictEdit)</span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a>            tEval[i, j] <span class="op">=</span> fnForwardPass(AEEdit)</span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tEval, tStep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-50" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> EvalJointWeight(tStepWeight, sParameterID, ddParameterDict, fnAE):</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># joint steps</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    ddParameterDictEdit <span class="op">=</span> copy.deepcopy(ddParameterDict)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    tStep <span class="op">=</span> torch.ones(arange(tStepWeight[<span class="dv">0</span>, <span class="dv">0</span>]).shape[<span class="dv">0</span>], tStepWeight.shape[<span class="dv">0</span>], tStepWeight.shape[<span class="dv">1</span>]) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(tStepWeight.shape[<span class="dv">1</span>]):</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(tStepWeight.shape[<span class="dv">0</span>]):</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>            tStep[:, i, j] <span class="op">=</span> arange(tStepWeight[i, j])</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>    tEval <span class="op">=</span> torch.ones(tStep.shape[<span class="dv">0</span>]) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, step <span class="kw">in</span> tqdm(<span class="bu">enumerate</span>(tStep)):</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>        ddParameterDictEdit <span class="op">=</span> copy.deepcopy(ddParameterDict)</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>        ddParameterDictEdit[sParameterID] <span class="op">=</span> ddParameterDict[sParameterID] <span class="op">+</span> step</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>        AEEdit <span class="op">=</span> fnAE</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>        AEEdit.load_state_dict(ddParameterDictEdit)</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>        tEval[k] <span class="op">=</span> fnForwardPass(AEEdit)</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tEval, tStep</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> EvalMarginalWeight(tStepWeight, sParameterID, ddParameterDict, fnAE):</span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># joint steps</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>    ddParameterDictEdit <span class="op">=</span> copy.deepcopy(ddParameterDict)</span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>    tStep <span class="op">=</span> torch.ones(arange(tStepWeight[<span class="dv">0</span>, <span class="dv">0</span>]).shape[<span class="dv">0</span>], tStepWeight.shape[<span class="dv">0</span>], tStepWeight.shape[<span class="dv">1</span>]) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(tStepWeight.shape[<span class="dv">1</span>]):</span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(tStepWeight.shape[<span class="dv">0</span>]):</span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>            tStep[:, i, j] <span class="op">=</span> arange(tStepWeight[i, j])</span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>    tEval <span class="op">=</span> torch.ones(tStep.shape[<span class="dv">0</span>], tStep.shape[<span class="dv">1</span>], tStep.shape[<span class="dv">2</span>]) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(tStep.shape[<span class="dv">2</span>]):</span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(tStep.shape[<span class="dv">1</span>])):</span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> k, step <span class="kw">in</span> <span class="bu">enumerate</span>(tStep):</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>                ddParameterDictEdit <span class="op">=</span> copy.deepcopy(ddParameterDict)</span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a>                ddParameterDictEdit[sParameterID][i, j] <span class="op">=</span> ddParameterDict[sParameterID][i, j] <span class="op">+</span> step[i, j]</span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a>                AEEdit <span class="op">=</span> fnAE</span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>                AEEdit.load_state_dict(ddParameterDictEdit)</span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a>                tEval[k, i, j] <span class="op">=</span> fnForwardPass(AEEdit)</span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tEval, tStep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-51" class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>ddNew, ddOld <span class="op">=</span> ae_new.state_dict(), ae.state_dict()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-54" class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(lSteps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="110">
<pre><code>10</code></pre>
</div>
</div>
<div id="cell-55" class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>lSteps <span class="op">=</span> []</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">11</span>):</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    lSteps[i] <span class="op">=</span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-56" class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> EvalJointFull(ddNew, ddOld, fnAE):</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    ddStep <span class="op">=</span> {}</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> keys, values <span class="kw">in</span> ddNew.items():</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>        ddStep[keys] <span class="op">=</span> ddNew[keys] <span class="op">-</span> ddOld[keys]</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    ddEdit <span class="op">=</span> {}</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    lSteps <span class="op">=</span> []</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">11</span>):</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> keys, values <span class="kw">in</span> ddNew.items():</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>            ddEdit[keys] <span class="op">=</span> ddOld[keys] <span class="op">+</span> (ddStep[keys] <span class="op">/</span> <span class="dv">10</span> <span class="op">*</span> i)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>        lSteps.append(ddEdit)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>    tEval <span class="op">=</span> torch.ones(<span class="bu">len</span>(lSteps)) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, dd <span class="kw">in</span> tqdm(<span class="bu">enumerate</span>(lSteps)):</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>        AEEdit <span class="op">=</span> fnAE</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>        AEEdit.load_state_dict(dd)</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>        tEval[k] <span class="op">=</span> fnForwardPass(AEEdit)</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tEval, lSteps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-57" class="cell" data-execution_count="156">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>ddStep <span class="op">=</span> {}</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> keys, values <span class="kw">in</span> ddNew.items():</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    ddStep[keys] <span class="op">=</span> ddNew[keys] <span class="op">-</span> ddOld[keys]</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>ddEdit <span class="op">=</span> {}</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>AEEdit <span class="op">=</span> Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>)</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>AEEdit.load_state_dict(ddOld)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>lNLL <span class="op">=</span> [fnForwardPass(AEEdit)]</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> keys, values <span class="kw">in</span> ddNew.items():</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>        ddEdit[keys] <span class="op">=</span> ddOld[keys] <span class="op">+</span> (ddStep[keys] <span class="op">/</span> <span class="dv">10</span> <span class="op">*</span> (i <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    AEEdit <span class="op">=</span> Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>)</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    AEEdit.load_state_dict(ddEdit)</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>    lNLL.append(fnForwardPass(AEEdit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-58" class="cell" data-execution_count="157">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>plt.plot(lNLL)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"-LL for steps in full model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="157">
<pre><code>Text(0.5, 1.0, '-LL for steps in full model')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-60-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-59" class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>ddOld[<span class="st">"encoder.0.weight"</span>], ddNew[<span class="st">"encoder.0.weight"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="133">
<pre><code>(tensor([[ 3.0594,  2.4993, -2.9531,  0.9324, -0.5545,  0.8763,  3.0161,  3.1553,
           1.4589,  2.3604, -1.4773, -2.0789, -0.8432, -4.4479, -4.2937, -3.1293,
          -1.1113, -4.2942, -4.9459, -2.9894],
         [ 1.9892,  1.1749,  4.8698,  1.4679,  3.1484,  0.0862,  2.6017,  3.2407,
           2.8729,  1.6721, -0.6971, -0.7636,  0.3717,  2.1758, -1.1616, -0.4697,
           0.0593,  1.4240, -0.6454, -1.1522]], device='mps:0'),
 tensor([[ 2.9627,  2.4062, -2.9694,  0.9802, -0.5596,  0.9394,  3.0167,  3.0659,
           1.5103,  2.3603, -1.4675, -2.1075, -0.8705, -4.4825, -4.3018, -3.1419,
          -1.1329, -4.3098, -4.9683, -3.0179],
         [ 2.0775,  1.2247,  4.8864,  1.4828,  3.1575,  0.0344,  2.6334,  3.3119,
           2.9276,  1.6756, -0.6993, -0.7767,  0.3752,  2.1918, -1.1648, -0.4537,
           0.0862,  1.4177, -0.6539, -1.1476]], device='mps:0'))</code></pre>
</div>
</div>
<div id="cell-60" class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>ddStep[<span class="st">"encoder.0.weight"</span>] <span class="op">/</span> <span class="dv">10</span> <span class="op">*</span> <span class="dv">5</span> <span class="op">+</span> ddOld[<span class="st">"encoder.0.weight"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="138">
<pre><code>tensor([[ 3.0110,  2.4527, -2.9612,  0.9563, -0.5570,  0.9078,  3.0164,  3.1106,
          1.4846,  2.3603, -1.4724, -2.0932, -0.8569, -4.4652, -4.2978, -3.1356,
         -1.1221, -4.3020, -4.9571, -3.0036],
        [ 2.0333,  1.1998,  4.8781,  1.4753,  3.1530,  0.0603,  2.6176,  3.2763,
          2.9003,  1.6739, -0.6982, -0.7702,  0.3735,  2.1838, -1.1632, -0.4617,
          0.0728,  1.4208, -0.6497, -1.1499]], device='mps:0')</code></pre>
</div>
</div>
<div id="cell-61" class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>fnForwardPass(ae_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="95">
<pre><code>1.4227309226989746</code></pre>
</div>
</div>
<div id="cell-62" class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>tEvalFull, lSteps <span class="op">=</span> EvalJointFull(ae.state_dict(), ae_new.state_dict(), Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>10it [00:01,  5.61it/s]</code></pre>
</div>
</div>
<div id="cell-63" class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>AEEdit <span class="op">=</span> Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>AEEdit.load_state_dict(lSteps[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="124">
<pre><code>&lt;All keys matched successfully&gt;</code></pre>
</div>
</div>
<div id="cell-64" class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>fnForwardPass(AEEdit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<pre><code>1.0270092487335205</code></pre>
</div>
</div>
<div id="cell-65" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Encoder Weights</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>tEval, tStep <span class="op">=</span> EvalJointWeight(tStepEncoderWeight, <span class="st">"encoder.0.weight"</span>, ae.state_dict(), Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>))</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>plt.plot(tEval.detach().cpu().numpy())</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"-LL for joint steps in Encoder Weights"</span>)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>tEval, tStep <span class="op">=</span> EvalMarginalWeight(tStepEncoderWeight, <span class="st">"encoder.0.weight"</span>, ae.state_dict(), Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>))</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>tEval.shape, tStep.shape </span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(tEval.shape[<span class="dv">1</span>], tEval.shape[<span class="dv">2</span>], figsize <span class="op">=</span> (<span class="dv">30</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(tEval.shape[<span class="dv">1</span>]):</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(tEval.shape[<span class="dv">2</span>]):</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>        ax[i, j].plot(tEval[:, i, j].detach().cpu().numpy())</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>        ax[i, j].set_title(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">,</span> j<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ax[i, j].set_xticks(np.arange(11), tStep.detach().cpu().numpy()[:, i, j])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>0it [00:00, ?it/s]huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
    - Avoid using `tokenizers` before the fork if possible
    - Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
11it [00:02,  4.35it/s]
100%|██████████| 2/2 [00:03&lt;00:00,  1.53s/it]
100%|██████████| 2/2 [00:03&lt;00:00,  1.56s/it]
100%|██████████| 2/2 [00:03&lt;00:00,  1.65s/it]
100%|██████████| 2/2 [00:02&lt;00:00,  1.46s/it]
100%|██████████| 2/2 [00:02&lt;00:00,  1.44s/it]
100%|██████████| 2/2 [00:03&lt;00:00,  1.55s/it]
100%|██████████| 2/2 [00:02&lt;00:00,  1.47s/it]
100%|██████████| 2/2 [00:02&lt;00:00,  1.43s/it]
100%|██████████| 2/2 [00:02&lt;00:00,  1.45s/it]
100%|██████████| 2/2 [00:02&lt;00:00,  1.40s/it]
100%|██████████| 2/2 [00:02&lt;00:00,  1.43s/it]
100%|██████████| 2/2 [00:03&lt;00:00,  1.51s/it]
100%|██████████| 2/2 [00:02&lt;00:00,  1.48s/it]
100%|██████████| 2/2 [00:02&lt;00:00,  1.45s/it]
100%|██████████| 2/2 [00:02&lt;00:00,  1.46s/it]
100%|██████████| 2/2 [00:02&lt;00:00,  1.47s/it]
100%|██████████| 2/2 [00:02&lt;00:00,  1.42s/it]
100%|██████████| 2/2 [00:02&lt;00:00,  1.42s/it]
100%|██████████| 2/2 [00:03&lt;00:00,  1.65s/it]
100%|██████████| 2/2 [00:03&lt;00:00,  1.51s/it]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-67-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-67-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-66" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Decoder Weights</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>tEval, tStep <span class="op">=</span> EvalJointWeight(tStepDecoderWeight, <span class="st">"decoder.0.weight"</span>, ae.state_dict(), Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>))</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>plt.plot(tEval.detach().cpu().numpy())</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"-LL for joint steps in Decoder Weights"</span>)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>tEvalDecoderWeight, tStep <span class="op">=</span> EvalMarginalWeight(tStepDecoderWeight, <span class="st">"decoder.0.weight"</span>, ae.state_dict(), Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>))</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>tEvalDecoderWeight.shape, tStep.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>11it [00:02,  5.40it/s]
100%|██████████| 768/768 [21:08&lt;00:00,  1.65s/it]
100%|██████████| 768/768 [42:32&lt;00:00,  3.32s/it]  </code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-68-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-67" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>torch.Size([768, 2])</code></pre>
</div>
</div>
<div id="cell-68" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>tEvalDecoderWeight[:,(tEvalDecoderWeight[<span class="op">-</span><span class="dv">1</span>, :, : ] <span class="op">&gt;</span> <span class="fl">1.0270</span>)].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<pre><code>torch.Size([11, 283])</code></pre>
</div>
</div>
<div id="cell-69" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>plt.plot(tEvalDecoderWeight[:,(tEvalDecoderWeight[<span class="op">-</span><span class="dv">1</span>, :, : ] <span class="op">&gt;</span> <span class="fl">1.0270</span>)].detach().cpu().numpy())</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>plt.plot(np.repeat(<span class="fl">1.0270</span>, <span class="dv">11</span>), <span class="st">"--"</span>)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-71-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-70" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>torch.<span class="bu">sum</span>(tEvalDecoderWeight[<span class="op">-</span><span class="dv">1</span>, :, :] <span class="op">-</span> tEvalDecoderWeight[<span class="dv">0</span>, :, :] ) <span class="op">+</span> torch.<span class="bu">sum</span>(tEvalDecoderBias[<span class="op">-</span><span class="dv">1</span>, :] <span class="op">-</span> tEvalDecoderBias[<span class="dv">0</span>, :])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<pre><code>tensor(-3.0339, device='mps:0')</code></pre>
</div>
</div>
<div id="cell-71" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">768</span>):</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].plot(tEvalDecoderWeight[:, i, <span class="dv">0</span>].detach().cpu().numpy(), alpha <span class="op">=</span> <span class="fl">0.3</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].hlines(<span class="fl">1.0270</span>, <span class="dv">0</span>, <span class="dv">10</span>, color <span class="op">=</span> <span class="st">"red"</span>)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_title(<span class="st">"EncoderDim 1"</span>)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].plot(tEvalDecoderWeight[:, i, <span class="dv">1</span>].detach().cpu().numpy(), alpha <span class="op">=</span> <span class="fl">0.3</span>)</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].hlines(<span class="fl">1.0270</span>, <span class="dv">0</span>, <span class="dv">10</span>, color <span class="op">=</span> <span class="st">"red"</span>)</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_title(<span class="st">"EncoderDim 2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-73-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-72" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(tEvalDecoderWeight.shape[<span class="dv">1</span>], tEvalDecoderWeight.shape[<span class="dv">2</span>], figsize <span class="op">=</span> (<span class="dv">30</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>):</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(tEvalDecoderWeight.shape[<span class="dv">2</span>]):</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>        ax[i, j].plot(tEvalDecoderWeight[:, i, j].detach().cpu().numpy())</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>        ax[i, j].set_title(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">,</span> j<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ax[i, j].set_xticks(np.arange(11), tStep.detach().cpu().numpy()[:, i, j])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>KeyboardInterrupt: </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error in callback &lt;function flush_figures at 0x17108fc10&gt; (for post_execute):</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>KeyboardInterrupt: </code></pre>
</div>
</div>
<div id="cell-73" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Encoder Bias</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>tEval, tStep <span class="op">=</span> EvalJointBias(tStepEncoderBias, <span class="st">"encoder.0.bias"</span>, ae.state_dict(), Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>))</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>plt.plot(tEval.detach().cpu().numpy())</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"-LL for joint steps in Encoder Bias"</span>)</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>tEval, tStep <span class="op">=</span> EvalMarginalBias(tStepEncoderBias, <span class="st">"encoder.0.bias"</span>, ae.state_dict(), Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>))</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>tEval.shape, tStep.shape </span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, tEval.shape[<span class="dv">1</span>], figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(tEval.shape[<span class="dv">1</span>]):</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>    ax[i].plot(tEval[:, i].detach().cpu().numpy())</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(<span class="ss">f"Bias EncoderDim </span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>    ax[i].set_ylabel(<span class="st">"-LL"</span>)</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ax[i].set_xticks(np.arange(11), tStep.detach().cpu().numpy()[:, i])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>11it [00:10,  1.10it/s]
100%|██████████| 2/2 [00:09&lt;00:00,  4.69s/it]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-75-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-75-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-74" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Decoder Bias</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>tEval, tStep <span class="op">=</span> EvalJointBias(tStepDecoderBias, <span class="st">"decoder.0.bias"</span>, ae.state_dict(), Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>))</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>plt.plot(tEval.detach().cpu().numpy())</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"-LL for joint steps in Decoder Bias"</span>)</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>tEvalDecoderBias, tStep <span class="op">=</span> EvalMarginalBias(tStepDecoderBias, <span class="st">"decoder.0.bias"</span>, ae.state_dict(), Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>))</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>tEval.shape, tStep.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>11it [00:08,  1.33it/s]
100%|██████████| 768/768 [27:12&lt;00:00,  2.13s/it]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-76-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-75" class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, tEvalDecoderBias.shape[<span class="dv">1</span>], figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(tEvalDecoderBias.shape[<span class="dv">1</span>]):</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>    ax[i].plot(tEvalDecoderBias[:, i].detach().cpu().numpy())</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(<span class="ss">f"Bias EncoderDim </span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>    ax[i].set_ylabel(<span class="st">"-LL"</span>)</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ax[i].set_xticks(np.arange(11), tStep.detach().cpu().numpy()[:, i])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-76" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>plt.plot(tEvalDecoderBias.detach().cpu().numpy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-78-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-77" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>tEvalDecoderBias.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>torch.Size([11, 768])</code></pre>
</div>
</div>
<div id="cell-78" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>plt.plot(tEvalDecoderBias[:,(tEvalDecoderBias[<span class="op">-</span><span class="dv">1</span>, : ] <span class="op">&gt;</span> <span class="fl">1.0270</span>)].detach().cpu().numpy())</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>plt.plot(np.repeat(<span class="fl">1.0270</span>, <span class="dv">11</span>), <span class="st">"--"</span>)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-80-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-79" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the tensors to disk</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>torch.save(tEvalDecoderWeight, <span class="st">"tEvalDecoderWeights.pt"</span>)</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="co">#torch.save(tEvalEncoderWeight, "tEvalDecoderWeights.pt")</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>torch.save(tEvalDecoderBias, <span class="st">"tEvalDecoderBias.pt"</span>)</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a><span class="co">#torch.save(tEvalEncoderBias, "tEvalDecoderBias.pt")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-80" class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>EvalJointBias(tStepEncoderBias, <span class="st">"encoder.0.bias"</span>, ae.state_dict(), Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>))</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>EvalMarginalBias(tStepEncoderBias, <span class="st">"encoder.0.bias"</span>, ae.state_dict(), Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>11it [00:01,  5.68it/s]
100%|██████████| 2/2 [00:02&lt;00:00,  1.36s/it]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>tensor([[1.0270, 1.0270],
        [1.0250, 1.0264],
        [1.0231, 1.0258],
        [1.0215, 1.0251],
        [1.0200, 1.0245],
        [1.0187, 1.0240],
        [1.0175, 1.0234],
        [1.0166, 1.0228],
        [1.0158, 1.0222],
        [1.0151, 1.0217],
        [1.0147, 1.0212]], device='mps:0')</code></pre>
</div>
</div>
<div id="cell-81" class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>EvalJointBias(tStepDecoderBias, <span class="st">"decoder.0.bias"</span>, ae.state_dict(), Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>))</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>EvalMarginalBias(tStepDecoderBias, <span class="st">"decoder.0.bias"</span>, ae.state_dict(), Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>11it [00:01,  6.07it/s]</code></pre>
</div>
</div>
<div id="cell-82" class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> step <span class="kw">in</span> tStep:</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(step)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tensor([0., 0.], device='mps:0')
tensor([-0.0071,  0.0033], device='mps:0')
tensor([-0.0143,  0.0066], device='mps:0')
tensor([-0.0214,  0.0098], device='mps:0')
tensor([-0.0285,  0.0131], device='mps:0')
tensor([-0.0357,  0.0164], device='mps:0')
tensor([-0.0428,  0.0197], device='mps:0')
tensor([-0.0499,  0.0230], device='mps:0')
tensor([-0.0571,  0.0262], device='mps:0')
tensor([-0.0642,  0.0295], device='mps:0')
tensor([-0.0713,  0.0328], device='mps:0')</code></pre>
</div>
</div>
<div id="cell-83" class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>tStep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>tensor([[ 0.0000,  0.0000],
        [-0.0071,  0.0033],
        [-0.0143,  0.0066],
        [-0.0214,  0.0098],
        [-0.0285,  0.0131],
        [-0.0357,  0.0164],
        [-0.0428,  0.0197],
        [-0.0499,  0.0230],
        [-0.0571,  0.0262],
        [-0.0642,  0.0295],
        [-0.0713,  0.0328]], device='mps:0')</code></pre>
</div>
</div>
<div id="cell-84" class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>tRange</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>tensor([ 0.0000, -0.0071, -0.0143, -0.0214, -0.0285, -0.0357, -0.0428, -0.0499,
        -0.0571, -0.0642, -0.0713], device='mps:0')</code></pre>
</div>
</div>
<div id="cell-85" class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>state_dict <span class="op">=</span> ae.state_dict()</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>tEval <span class="op">=</span> torch.ones((arange(tStepEncoderBias[<span class="dv">0</span>]).size(<span class="dv">0</span>), ae.encoder[<span class="dv">0</span>].bias.size(<span class="dv">0</span>))) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(ae.encoder[<span class="dv">0</span>].bias.shape[<span class="dv">0</span>])):</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>        AEEdit <span class="op">=</span> Autoencoder(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">768</span>)</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>        AEEdit.load_state_dict(state_dict)</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>        tEval[:, i] <span class="op">=</span> ManipulateAE(AEEdit, AEEdit.encoder[<span class="dv">0</span>].bias[i], arange(tStepEncoderBias[i]), <span class="st">"EncoderBias"</span>, fnForwardPass)</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> AEEdit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>  0%|          | 0/2 [00:00&lt;?, ?it/s]huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
    - Avoid using `tokenizers` before the fork if possible
    - Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
 50%|█████     | 1/2 [00:01&lt;00:01,  1.62s/it]100%|██████████| 2/2 [00:02&lt;00:00,  1.46s/it]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>tensor(-1.7928, device='mps:0')
tensor(-1.7999, device='mps:0')
tensor(-1.8071, device='mps:0')
tensor(-1.8142, device='mps:0')
tensor(-1.8213, device='mps:0')
tensor(-1.8285, device='mps:0')
tensor(-1.8356, device='mps:0')
tensor(-1.8428, device='mps:0')
tensor(-1.8499, device='mps:0')
tensor(-1.8570, device='mps:0')
tensor(-1.8642, device='mps:0')
tensor(1.6638, device='mps:0')
tensor(1.6638, device='mps:0')
tensor(1.6638, device='mps:0')
tensor(1.6638, device='mps:0')
tensor(1.6638, device='mps:0')
tensor(1.6638, device='mps:0')
tensor(1.6638, device='mps:0')
tensor(1.6638, device='mps:0')
tensor(1.6638, device='mps:0')
tensor(1.6638, device='mps:0')
tensor(1.6638, device='mps:0')</code></pre>
</div>
</div>
<div id="cell-86" class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">False</span>, sharex<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(tEval.shape[<span class="dv">1</span>]):</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>    ax[i].plot(arange(tStepEncoderBias[i]).detach().cpu().numpy(), tEval[:, i].detach().cpu().numpy())</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(<span class="ss">f"Encoder Bias </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>    ax[i].set_xlabel(<span class="st">"ID Parameter"</span>)</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>    ax[i].set_ylabel(<span class="st">"-LL"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-88-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-87" class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>AEEdit <span class="op">=</span> copy.deepcopy(ae)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>tEval <span class="op">=</span> torch.ones((arange(tStepDecoderBias[i]).size(<span class="dv">0</span>), AEEdit.decoder[<span class="dv">0</span>].bias.size(<span class="dv">0</span>))) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(AEEdit.decoder[<span class="dv">0</span>].bias.shape[<span class="dv">0</span>])):</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>    AEEdit <span class="op">=</span> copy.deepcopy(ae)</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>        tEval[:, i] <span class="op">=</span> ManipulateAE(AEEdit, AEEdit.decoder[<span class="dv">0</span>].bias[i], arange(tStepDecoderBias[i]), <span class="st">"DecoderBias"</span>, fnForwardPass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 768/768 [18:02&lt;00:00,  1.41s/it]</code></pre>
</div>
</div>
<div id="cell-88" class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>plt.plot(arange(tStepDecoderBias[i]).detach().cpu().numpy(), tEval[:, i].detach().cpu().numpy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-90-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-89" class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>tEval[tRange.detach().cpu().numpy() <span class="op">==</span> <span class="dv">0</span>, :]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>tensor([[1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077, 1.2077,
         1.2077, 1.2077, 1.2077]], device='mps:0')</code></pre>
</div>
</div>
<div id="cell-90" class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> tEval.dim() <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>   <span class="bu">print</span>(torch.<span class="bu">max</span>(torch.<span class="bu">max</span>(tEval, dim<span class="op">=</span><span class="dv">0</span>)[<span class="dv">0</span>] <span class="op">-</span> tEval[tRange.detach().cpu().numpy() <span class="op">==</span> <span class="dv">0</span>, :]))</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(torch.<span class="bu">max</span>(torch.<span class="bu">max</span>(tEval, dim<span class="op">=</span><span class="dv">0</span>)[<span class="dv">0</span>] <span class="op">-</span> tEval[tRange.detach().cpu().numpy() <span class="op">==</span> <span class="dv">0</span>, :, :]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tensor(0.0101, device='mps:0')</code></pre>
</div>
</div>
<div id="cell-91" class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>torch.<span class="bu">sum</span>((torch.<span class="bu">max</span>(tEval, dim<span class="op">=</span><span class="dv">0</span>)[<span class="dv">0</span>] <span class="op">-</span> tEval[tRange.detach().cpu().numpy() <span class="op">==</span> <span class="dv">0</span>, :]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>tensor(0.0160, device='mps:0')</code></pre>
</div>
</div>
<ul>
<li>DecoderWeights max: 0.0047, -0.1 to 0.1</li>
<li>EncoderWeights max: 0.0026, -0.04 to 0.04</li>
<li>DecoderBias max:</li>
<li>EncoderBias max: 0.0004, -0.01 to 0.01</li>
</ul>
<div id="cell-93" class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>tEval.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>torch.Size([9, 2])</code></pre>
</div>
</div>
<div id="cell-94" class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>tEval.shape</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(tRange.detach().cpu().numpy(), tEval[:, <span class="dv">0</span>].detach().cpu().numpy())</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="co">#ax[0].set_ylim([1.42, 1.43])</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(tRange.detach().cpu().numpy(), tEval[:, <span class="dv">1</span>].detach().cpu().numpy())</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="co">#ax[1].set_ylim([1.42, 1.43])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-95-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-95" class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>tEval.shape</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(tEval.shape[<span class="dv">1</span>]):</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>    ax.plot(tRange.detach().cpu().numpy(), tEval[:, i].detach().cpu().numpy(), alpha <span class="op">=</span> <span class="fl">0.3</span>)</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ax[0].set_ylim([1.415, 1.420])</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ax[1].plot(tRange.detach().cpu().numpy(), tEval[1, i].detach().cpu().numpy())</span></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ax[0].set_ylim([1.415, 1.420])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-96-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-96" class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(tEval.shape[<span class="dv">2</span>]):</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].plot(tRange.detach().cpu().numpy(), tEval[:, <span class="dv">0</span>, i].detach().cpu().numpy(), alpha <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ax[0].set_ylim([0.848, 0.856])</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].plot(tRange.detach().cpu().numpy(), tEval[:, <span class="dv">1</span>, i].detach().cpu().numpy(), alpha <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ax[1].set_ylim([0.848, 0.856])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-97-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-97" class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>tEval.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="455">
<pre><code>torch.Size([9, 768])</code></pre>
</div>
</div>
<div id="cell-98" class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(tEval.shape[<span class="dv">1</span>]):</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].plot(tRange.detach().cpu().numpy(), tEval[:, i].detach().cpu().numpy(), alpha <span class="op">=</span> <span class="fl">0.1</span>)</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_ylim([<span class="fl">1.204</span>, <span class="fl">1.212</span>])</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].plot(tRange.detach().cpu().numpy(), tEval[:, i].detach().cpu().numpy(), alpha <span class="op">=</span> <span class="fl">0.1</span>)</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_ylim([<span class="fl">1.204</span>, <span class="fl">1.212</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-99-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-99" class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>, tEval.shape[<span class="dv">1</span>], <span class="dv">100</span>):</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].plot(tRange.detach().cpu().numpy(), tEval[:, i].detach().cpu().numpy())</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_ylim([<span class="fl">1.204</span>, <span class="fl">1.212</span>])</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].plot(tRange.detach().cpu().numpy(), tEval[:, i].detach().cpu().numpy())</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_ylim([<span class="fl">1.204</span>, <span class="fl">1.212</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-100-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-100" class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> tEval.dim() <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(tEval.shape[<span class="dv">1</span>]):</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(tEval.shape[<span class="dv">2</span>]):</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>            ax.plot(tRange.detach().cpu().numpy(), tEval[:, i, j].detach().cpu().numpy())</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> tEval.dim() <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(tEval.shape[<span class="dv">1</span>]):</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>        ax[i].plot(tRange.detach().cpu().numpy(), tEval[:, i].detach().cpu().numpy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="analyze_ll_files/figure-html/cell-101-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-101" class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>sRunName <span class="op">=</span> <span class="st">"test_moving_clip"</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>dLearningRate <span class="op">=</span> <span class="fl">1e-1</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>dEps <span class="op">=</span> <span class="fl">1e-3</span> <span class="co"># </span><span class="al">NOTE</span><span class="co">: It seems that the -LL is computed wrt to e, not base 10! Hence e^(-dEps) = L</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>dWeightDecay <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>iBreakAtEpochs <span class="op">=</span> <span class="fl">1e4</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>iBatchSize <span class="op">=</span> <span class="bu">min</span>(<span class="dv">32</span>, iClaims)</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> ConstantStepOptimizer(ae.parameters(), lr<span class="op">=</span>dLearningRate)</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a><span class="co"># optimizer = optim.Adam(ae.parameters(), lr=dLearningRate, weight_decay=dWeightDecay)</span></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>iEpoch <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>lLoss <span class="op">=</span> []</span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>lTime <span class="op">=</span> []</span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>    iEpoch <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>    tic <span class="op">=</span> time.time()</span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: Necessary to keep making use of batching of the LLM, otherwise runs sequential ...</span></span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> ForwardPass(tOHETarget, tInputEmbeddings, tTarget, model, ae, iBatchSize)</span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#get_dot = register_hooks(loss)</span></span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a>    loss.backward(retain_graph<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a>    lLoss.append(loss.item())</span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-27"><a href="#cb157-27" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb157-28"><a href="#cb157-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-29"><a href="#cb157-29" aria-hidden="true" tabindex="-1"></a>    toc <span class="op">=</span> time.time()</span>
<span id="cb157-30"><a href="#cb157-30" aria-hidden="true" tabindex="-1"></a>    dTime <span class="op">=</span> toc <span class="op">-</span> tic</span>
<span id="cb157-31"><a href="#cb157-31" aria-hidden="true" tabindex="-1"></a>    lTime.append(dTime)</span>
<span id="cb157-32"><a href="#cb157-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-33"><a href="#cb157-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (iEpoch <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>) <span class="kw">or</span> (iEpoch <span class="op">==</span> <span class="dv">1</span>):</span>
<span id="cb157-34"><a href="#cb157-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Epoch </span><span class="sc">{</span>iEpoch<span class="sc">}</span><span class="ss">, Loss: </span><span class="sc">{</span>loss<span class="sc">.</span>item()<span class="sc">}</span><span class="ss">, Avg. time per Epoch </span><span class="sc">{</span>np<span class="sc">.</span>mean(lTime)<span class="sc">:.2f}</span><span class="ss"> sec"</span>)</span>
<span id="cb157-35"><a href="#cb157-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-36"><a href="#cb157-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> iEpoch <span class="op">&gt;=</span> iBreakAtEpochs:</span>
<span id="cb157-37"><a href="#cb157-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb157-38"><a href="#cb157-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb157-39"><a href="#cb157-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> loss.item() <span class="op">&lt;</span> dEps:</span>
<span id="cb157-40"><a href="#cb157-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1, Loss: 6.650392055511475, Avg. time per Epoch 3.47 sec</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>KeyboardInterrupt: </code></pre>
</div>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>